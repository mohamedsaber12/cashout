{% extends 'new_base.html' %}
{% load static %}
{% load i18n %}
{% load custom_tags %}
{% block title %} Transactions {% endblock %}
{% block gentellacss %}
<!-- Datatables -->
<link href="{% static 'gentella/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'gentella/vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'gentella/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'gentella/vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'gentella/vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css' %}" rel="stylesheet">
{% endblock %}

{% block body %}


<div class="row">
    <div hidden id="all-alert-msg" class="alert alert-info col-md-6 pull-{{'left'|invert_dir:LANGUAGE_CODE}}">
        {% trans 'You will receive an email shortly with the file to download' %}
    </div>
    <!-- button -->
    <div class="col-md-6 pull-{{'right'|invert_dir:LANGUAGE_CODE}}">
        <button id="export-all"
            class="btn btn-success pull-{{'right'|invert_dir:LANGUAGE_CODE}}">{% trans 'Export All' %}
        </button>
    </div>
</div>
{% if has_failed %}
<div class="row">
    <div hidden id="failed-alert-msg" class="alert alert-info col-md-6 pull-{{'left'|invert_dir:LANGUAGE_CODE}}">
        {% trans 'You will receive an email shortly with the failed data file to download' %}
    </div>
    <!-- button -->
    <div class="col-md-6 pull-{{'right'|invert_dir:LANGUAGE_CODE}}">
        <button  id="export-failed" class="btn btn-success pull-{{'right'|invert_dir:LANGUAGE_CODE}}">{% trans 'Export Failed' %}
        </button>
    </div>
</div>
{%endif%}
{% if has_success %}
<div class="row">
    <div hidden id="success-alert-msg" class="alert alert-info col-md-6 pull-{{'left'|invert_dir:LANGUAGE_CODE}}">
        {% trans 'You will receive an email shortly with the success data file to download' %}
    </div>
    <!-- button -->
    <div class="col-md-6 pull-{{'right'|invert_dir:LANGUAGE_CODE}}">
        <button id="export-success"
            class="btn btn-success pull-{{'right'|invert_dir:LANGUAGE_CODE}}">{% trans 'Export Success' %}
        </button>
    </div>
</div>
{%endif%}

<div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
            <div class="x_title">
                <h2>{% trans 'Transactions' %} <small>{% trans 'Document name:' %} <a target="_blank" href="{% url 'data:download_doc' doc_obj.id %}">{{doc_obj.filename}}</a></small></h2>
                <ul class="nav navbar-right panel_toolbox">
                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                </ul>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">

                <table class="table table-striped table-bordered" id="transaction-table">
                    <thead>
                        <tr>
                            <th>{% trans 'Wallet Number' %}</th>
                            <th>{% trans 'Amount' %}</th>
                            {% if not is_normal_flow %}<th>{% trans 'Issuer' %}</th>{% endif %}
                            <th>{% trans 'Disbursed?' %}</th>
                            <th style="width: 30%;">{% trans 'Disbursement Status Description' %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for data in disbursement_data %}
                        <tr>
                            <td>{{ data.msisdn }}</td>
                            <td>{{ data.amount }}</td>
                            {% if not is_normal_flow %}<td>{{ data.issuer }}</td>{% endif %}
                            <td style="text-align: center; font-size: 20px; padding-top: 3px; padding-bottom: 3px;">
                                {% if data.is_disbursed %}
                                    <span style="color: #2e6da4">&#10004;</span>
                                {% elif not data.reason %}
                                    <span>‚è≥</span>
                                {% else %}
                                    <span style="color: #942a25">&#10006;</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if data.reason %}
                                    {{ data.reason }}
                                {% else %}
                                    {% trans 'Disbursement process is running' %}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<!-- Datatables -->
<script src="{% static 'gentella/vendors/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-buttons/js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-buttons/js/buttons.flash.min.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-buttons/js/buttons.html5.min.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-buttons/js/buttons.print.min.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-keytable/js/dataTables.keyTable.min.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js' %}"></script>
<script src="{% static 'gentella/vendors/datatables.net-scroller/js/dataTables.scroller.min.js' %}"></script>
<script>
    $('#transaction-table').DataTable();

    $(document).ready(function () {

        $('#export-failed').on('click',function(ev) {
            $.ajax({
                type:'GET',
                url: '{{request.path}}' + '?export_failed=true',
                success: function (data, text, xhr) {
                    $('#failed-alert-msg').show()
                },
            })

        });
        $('#export-success').on('click', function (ev) {
            $.ajax({
                type: 'GET',
                url: '{{request.path}}' + '?export_success=true',
                success: function (data, text, xhr) {
                    $('#success-alert-msg').show()
                },
            })

        });
        $('#export-all').on('click', function (ev) {
            $.ajax({
                type: 'GET',
                url: '{{request.path}}' + '?export_all=true',
                success: function (data, text, xhr) {
                    $('#all-alert-msg').show()
                },
            })

        });
    });

</script>


{% endblock %}
